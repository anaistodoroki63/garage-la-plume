<!doctype html>
<html lang="fr">
 <head>
  <meta charset="UTF-8">
  <title>Garage La Plume - Server Manager</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="/_sdk/element_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&amp;family=Roboto:wght@400;500&amp;display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
        body {
            box-sizing: border-box;
        }
        
        html, body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        
        .app-wrapper {
            height: 100%;
            width: 100%;
            overflow-y: auto;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a1a2e 50%, #16213e 100%);
        }
        
        .garage-title {
            font-family: 'Rajdhani', sans-serif;
        }
        
        .body-text {
            font-family: 'Roboto', sans-serif;
        }
        
        .red-accent {
            color: #dc2626;
        }
        
        .purple-accent {
            color: #a855f7;
        }
        
        .red-bg {
            background-color: #dc2626;
        }
        
        .red-border {
            border-color: #dc2626;
        }
        
        .purple-border {
            border-color: #a855f7;
        }
        
        .card-bg {
            background: rgba(30, 30, 40, 0.9);
            backdrop-filter: blur(10px);
        }
        
        .input-style {
            background: rgba(15, 15, 20, 0.8);
            border: 1px solid rgba(100, 100, 120, 0.3);
            transition: all 0.3s ease;
        }
        
        .input-style:focus {
            border-color: #dc2626;
            box-shadow: 0 0 15px rgba(220, 38, 38, 0.3);
            outline: none;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(220, 38, 38, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(220, 38, 38, 0.5);
        }
        
        .btn-secondary {
            background: rgba(60, 60, 80, 0.8);
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            background: rgba(80, 80, 100, 0.9);
        }
        
        .nav-button {
            padding: 10px 20px;
            border-radius: 6px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            color: white;
            background: rgba(60, 60, 80, 0.6);
            text-decoration: none;
            display: inline-block;
        }
        
        .nav-button.active {
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        }
        
        .nav-button:not(.active):hover {
            background: rgba(80, 80, 100, 0.8);
        }
        
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 12px 24px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            z-index: 1000;
            animation: slideIn 0.3s ease;
        }
        
        .toast-success {
            background: linear-gradient(135deg, #059669, #047857);
        }
        
        .toast-error {
            background: linear-gradient(135deg, #dc2626, #991b1b);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes fadeOut {
            from { opacity: 1; }
            to { opacity: 0; }
        }
        
        .manager-tab.active {
            background: #a855f7 !important;
        }
        
        .user-item {
            background: rgba(25, 25, 35, 0.8);
            border: 1px solid rgba(168, 85, 247, 0.3);
            transition: all 0.2s ease;
            border-radius: 6px;
        }
        
        .user-item:hover {
            border-color: #a855f7;
            background: rgba(35, 35, 45, 0.9);
        }
    </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
 </head>
 <body>
  <div class="app-wrapper body-text text-gray-100"><!-- Header Navigation -->
   <header class="bg-black/80 backdrop-blur-md border-b-4 purple-border sticky top-0 z-50">
    <div class="max-w-6xl mx-auto px-6 py-4">
     <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <h1 class="garage-title text-3xl font-bold purple-accent">üîß Server Manager</h1>
      <nav>
       <div class="flex flex-wrap gap-2"><a href="?page=home" class="nav-button active" id="navHome">üè† Accueil</a> <a href="?page=manager" class="nav-button" id="navManager">‚öôÔ∏è Gestion</a>
       </div>
      </nav>
     </div>
    </div>
   </header><!-- Contenu dynamique -->
   <div id="content"></div><!-- Footer -->
   <footer class="bg-black/80 border-t-4 purple-border py-8 px-6 text-center mt-12">
    <p class="text-gray-400">¬© 2026 Garage La Plume - Server Manager</p>
   </footer>
  </div><!-- Toast Container -->
  <div id="toastContainer"></div>
  <script>
        // ============================================
        // Storage & Initialization
        // ============================================
        
        function initializeStorage() {
            if (!localStorage.getItem('garageUsers')) {
                localStorage.setItem('garageUsers', JSON.stringify([
                    { user: 'patron', pass: 'patron123', role: 'Patron' },
                    { user: 'luciano', pass: 'luciano', role: 'Employ√©' },
                    { user: 'killyan', pass: 'killyan', role: 'Employ√©' },
                    { user: 'anais', pass: 'anais', role: 'Gestionnaire Serveur' }
                ]));
            }
            if (!localStorage.getItem('garageEvents')) {
                localStorage.setItem('garageEvents', JSON.stringify([]));
            }
            if (!localStorage.getItem('garageClock')) {
                localStorage.setItem('garageClock', JSON.stringify([]));
            }
            if (!localStorage.getItem('garageFiles')) {
                localStorage.setItem('garageFiles', JSON.stringify([]));
            }
        }

        function getUsers() {
            return JSON.parse(localStorage.getItem('garageUsers') || '[]');
        }

        function saveUsers(users) {
            localStorage.setItem('garageUsers', JSON.stringify(users));
        }

        function getEvents() {
            return JSON.parse(localStorage.getItem('garageEvents') || '[]');
        }

        function saveEvents(events) {
            localStorage.setItem('garageEvents', JSON.stringify(events));
        }

        function getClockEntries() {
            return JSON.parse(localStorage.getItem('garageClock') || '[]');
        }

        function saveClockEntries(entries) {
            localStorage.setItem('garageClock', JSON.stringify(entries));
        }

        function getFiles() {
            return JSON.parse(localStorage.getItem('garageFiles') || '[]');
        }

        function saveFiles(files) {
            localStorage.setItem('garageFiles', JSON.stringify(files));
        }

        // ============================================
        // Toast Notifications
        // ============================================
        
        function showToast(message, type = 'success') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast toast-${type}`;
            toast.textContent = message;
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'fadeOut 0.3s ease forwards';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }

        // ============================================
        // Page Templates
        // ============================================

        const pages = {
            home: () => `
                <section class="py-16 px-6">
                    <div class="max-w-4xl mx-auto">
                        <div class="card-bg rounded-xl p-8 border-l-4 purple-border text-center">
                            <h2 class="garage-title text-4xl font-bold mb-4 purple-accent">üîß Gestionnaire de Serveur</h2>
                            <p class="text-gray-400 text-lg mb-8">Bienvenue dans le panneau de contr√¥le central. Acc√©dez √† la gestion compl√®te du serveur Garage La Plume.</p>
                            
                            <div class="grid md:grid-cols-2 gap-6 mb-8">
                                <div class="card-bg rounded-lg p-6 border-l-4 red-border">
                                    <h3 class="text-2xl font-bold red-accent mb-2">üë•</h3>
                                    <p class="font-bold text-white mb-1">Gestion Utilisateurs</p>
                                    <p class="text-gray-400 text-sm">Cr√©er, modifier ou supprimer des utilisateurs</p>
                                </div>
                                <div class="card-bg rounded-lg p-6 border-l-4 red-border">
                                    <h3 class="text-2xl font-bold red-accent mb-2">üìÖ</h3>
                                    <p class="font-bold text-white mb-1">√âv√©nements</p>
                                    <p class="text-gray-400 text-sm">G√©rer tous les √©v√©nements et plannings</p>
                                </div>
                                <div class="card-bg rounded-lg p-6 border-l-4 red-border">
                                    <h3 class="text-2xl font-bold red-accent mb-2">‚è±Ô∏è</h3>
                                    <p class="font-bold text-white mb-1">Pointages</p>
                                    <p class="text-gray-400 text-sm">Contr√¥ler et modifier les pointages employ√©s</p>
                                </div>
                                <div class="card-bg rounded-lg p-6 border-l-4 red-border">
                                    <h3 class="text-2xl font-bold red-accent mb-2">üíæ</h3>
                                    <p class="font-bold text-white mb-1">Donn√©es</p>
                                    <p class="text-gray-400 text-sm">Exporter/importer et r√©cup√©rer les donn√©es</p>
                                </div>
                            </div>

                            <a href="?page=manager" class="btn-primary px-8 py-3 rounded-lg font-semibold text-white inline-block">
                                Acc√©der au Panneau de Contr√¥le ‚Üí
                            </a>
                        </div>
                    </div>
                </section>
            `,

            manager: () => `
                <section class="py-16 px-6">
                    <div class="max-w-6xl mx-auto">
                        <div class="card-bg rounded-xl p-8 border-l-4 purple-border">
                            <h2 class="garage-title text-3xl font-bold mb-8 purple-accent">Panneau de Gestion Serveur</h2>
                            
                            <!-- Tabs Navigation -->
                            <div class="flex flex-wrap gap-2 mb-8 border-b border-gray-600 pb-4">
                                <button class="manager-tab active px-4 py-2 rounded-lg font-medium text-white bg-purple-600" data-tab="users">üë• Utilisateurs</button>
                                <button class="manager-tab px-4 py-2 rounded-lg font-medium text-white bg-gray-700" data-tab="events">üìÖ √âv√©nements</button>
                                <button class="manager-tab px-4 py-2 rounded-lg font-medium text-white bg-gray-700" data-tab="clock">‚è±Ô∏è Pointages</button>
                                <button class="manager-tab px-4 py-2 rounded-lg font-medium text-white bg-gray-700" data-tab="files">üìÅ Fichiers</button>
                                <button class="manager-tab px-4 py-2 rounded-lg font-medium text-white bg-gray-700" data-tab="recovery">üîÑ R√©cup√©ration</button>
                            </div>

                            <!-- Users Tab -->
                            <div id="usersTab" class="manager-tab-content space-y-4">
                                <h4 class="text-lg font-bold text-white mb-4">Gestion des Utilisateurs</h4>
                                <div class="space-y-3 max-h-96 overflow-y-auto mb-6">
                                    <div id="usersList"></div>
                                </div>
                                
                                <div class="border-t border-gray-600 pt-4">
                                    <h5 class="font-bold text-white mb-4">‚ûï Ajouter un nouvel utilisateur</h5>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2 text-gray-300">Identifiant</label>
                                            <input type="text" id="newUserName" class="input-style w-full px-4 py-2 rounded-lg text-white" placeholder="ex: jean">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2 text-gray-300">Mot de passe</label>
                                            <input type="password" id="newUserPass" class="input-style w-full px-4 py-2 rounded-lg text-white" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2 text-gray-300">R√¥le</label>
                                            <select id="newUserRole" class="input-style w-full px-4 py-2 rounded-lg text-white">
                                                <option value="Employ√©">Employ√©</option>
                                                <option value="Patron">Patron</option>
                                                <option value="Gestionnaire Serveur">Gestionnaire Serveur</option>
                                            </select>
                                        </div>
                                        <button id="addUserBtn" class="btn-primary py-2 rounded-lg font-medium text-white self-end">
                                            ‚úì Cr√©er Utilisateur
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Events Tab -->
                            <div id="eventsTab" class="manager-tab-content hidden space-y-4">
                                <h4 class="text-lg font-bold text-white mb-4">Gestion des √âv√©nements</h4>
                                <div class="space-y-3 max-h-96 overflow-y-auto mb-6">
                                    <div id="eventsList"></div>
                                </div>
                                
                                <div class="border-t border-gray-600 pt-4">
                                    <h5 class="font-bold text-white mb-4">‚ûï Ajouter un √©v√©nement</h5>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2 text-gray-300">Utilisateur</label>
                                            <select id="newEventUser" class="input-style w-full px-4 py-2 rounded-lg text-white">
                                                <option value="">S√©lectionner...</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2 text-gray-300">Date</label>
                                            <input type="date" id="newEventDate" class="input-style w-full px-4 py-2 rounded-lg text-white">
                                        </div>
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium mb-2 text-gray-300">Description</label>
                                            <input type="text" id="newEventText" class="input-style w-full px-4 py-2 rounded-lg text-white" placeholder="Description de l'√©v√©nement">
                                        </div>
                                        <button id="addEventManagerBtn" class="btn-primary md:col-span-2 py-2 rounded-lg font-medium text-white">
                                            ‚úì Ajouter √âv√©nement
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Clock Tab -->
                            <div id="clockTab" class="manager-tab-content hidden space-y-4">
                                <h4 class="text-lg font-bold text-white mb-4">Gestion des Pointages</h4>
                                <div class="space-y-3 max-h-96 overflow-y-auto mb-6">
                                    <div id="clockManagerList"></div>
                                </div>
                                
                                <div class="border-t border-gray-600 pt-4">
                                    <h5 class="font-bold text-white mb-4">‚ûï Ajouter un pointage</h5>
                                    <div class="grid md:grid-cols-2 gap-4">
                                        <div>
                                            <label class="block text-sm font-medium mb-2 text-gray-300">Utilisateur</label>
                                            <select id="newClockUser" class="input-style w-full px-4 py-2 rounded-lg text-white">
                                                <option value="">S√©lectionner...</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label class="block text-sm font-medium mb-2 text-gray-300">Type</label>
                                            <select id="newClockType" class="input-style w-full px-4 py-2 rounded-lg text-white">
                                                <option value="Entr√©e">‚úì Entr√©e</option>
                                                <option value="Sortie">‚úï Sortie</option>
                                            </select>
                                        </div>
                                        <div class="md:col-span-2">
                                            <label class="block text-sm font-medium mb-2 text-gray-300">Date et Heure</label>
                                            <input type="datetime-local" id="newClockTime" class="input-style w-full px-4 py-2 rounded-lg text-white">
                                        </div>
                                        <button id="addClockBtn" class="btn-primary md:col-span-2 py-2 rounded-lg font-medium text-white">
                                            ‚úì Ajouter Pointage
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Files Tab -->
                            <div id="filesTab" class="manager-tab-content hidden space-y-4">
                                <h4 class="text-lg font-bold text-white mb-4">Gestion des Fichiers</h4>
                                <div class="space-y-3 max-h-96 overflow-y-auto">
                                    <div id="filesManagerList"></div>
                                </div>
                            </div>

                            <!-- Recovery Tab -->
                            <div id="recoveryTab" class="manager-tab-content hidden space-y-6">
                                <h4 class="text-lg font-bold text-white mb-4">R√©cup√©ration et Maintenance</h4>
                                
                                <div class="bg-black/40 rounded-lg p-4 border border-red-500/30">
                                    <h5 class="font-bold text-red-400 mb-3">‚ö†Ô∏è Actions Critiques</h5>
                                    <p class="text-gray-400 text-sm mb-4">Attention: Ces actions affectent toutes les donn√©es du serveur</p>
                                    <div class="space-y-2">
                                        <button id="exportDataBtn" class="btn-primary w-full py-2 rounded-lg font-medium text-white">
                                            üíæ Exporter toutes les donn√©es (JSON)
                                        </button>
                                        <button id="importDataBtn" class="btn-secondary w-full py-2 rounded-lg font-medium text-white border border-gray-600">
                                            üì• Importer des donn√©es
                                        </button>
                                        <input type="file" id="importFile" class="hidden" accept=".json">
                                    </div>
                                </div>

                                <div class="bg-black/40 rounded-lg p-4 border border-yellow-500/30">
                                    <h5 class="font-bold text-yellow-400 mb-3">üîë Gestion des Mots de Passe</h5>
                                    <div id="backupInfo" class="text-sm text-gray-400 space-y-2 mb-4"></div>
                                    <div class="space-y-2">
                                        <button id="resetPasswordsBtn" class="w-full py-2 rounded-lg font-medium text-white bg-yellow-700 hover:bg-yellow-600 transition">
                                            üîê R√©initialiser tous les mots de passe
                                        </button>
                                        <button id="clearChangedPasswordsBtn" class="w-full py-2 rounded-lg font-medium text-white bg-yellow-700 hover:bg-yellow-600 transition">
                                            üîë Forcer changement MDP au prochain login
                                        </button>
                                    </div>
                                </div>

                                <div class="bg-black/40 rounded-lg p-4 border border-purple-500/30">
                                    <h5 class="font-bold text-purple-400 mb-3">üìä Statistiques Serveur</h5>
                                    <div id="serverStats" class="grid md:grid-cols-2 gap-4 text-sm">
                                        <div class="bg-black/30 p-3 rounded">
                                            <p class="text-gray-400">Utilisateurs</p>
                                            <p id="statsUsers" class="text-2xl font-bold text-white">0</p>
                                        </div>
                                        <div class="bg-black/30 p-3 rounded">
                                            <p class="text-gray-400">√âv√©nements</p>
                                            <p id="statsEvents" class="text-2xl font-bold text-white">0</p>
                                        </div>
                                        <div class="bg-black/30 p-3 rounded">
                                            <p class="text-gray-400">Pointages</p>
                                            <p id="statsClock" class="text-2xl font-bold text-white">0</p>
                                        </div>
                                        <div class="bg-black/30 p-3 rounded">
                                            <p class="text-gray-400">Fichiers</p>
                                            <p id="statsFiles" class="text-2xl font-bold text-white">0</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
            `
        };

        // ============================================
        // Router & Navigation
        // ============================================

        function getPageFromURL() {
            const params = new URLSearchParams(window.location.search);
            return params.get('page') || 'home';
        }

        function renderPage() {
            const page = getPageFromURL();
            const contentDiv = document.getElementById('content');
            
            document.querySelectorAll('.nav-button').forEach(btn => btn.classList.remove('active'));
            if (page === 'home') document.getElementById('navHome').classList.add('active');
            if (page === 'manager') document.getElementById('navManager').classList.add('active');
            
            if (pages[page]) {
                contentDiv.innerHTML = pages[page]();
                attachEventListeners();
                window.scrollTo(0, 0);
            }
        }

        function attachEventListeners() {
            const page = getPageFromURL();

            if (page === 'manager') {
                // Tab switching
                document.querySelectorAll('.manager-tab').forEach(tab => {
                    tab.addEventListener('click', () => {
                        document.querySelectorAll('.manager-tab').forEach(t => {
                            t.classList.remove('active');
                            t.style.background = 'rgba(60, 60, 80, 0.6)';
                        });
                        document.querySelectorAll('.manager-tab-content').forEach(c => c.classList.add('hidden'));
                        
                        tab.classList.add('active');
                        tab.style.background = '#a855f7';
                        const tabName = tab.getAttribute('data-tab');
                        document.getElementById(tabName + 'Tab').classList.remove('hidden');
                    });
                });

                // Initialize all tabs
                renderUsersList();
                renderEventsList();
                renderClockList();
                renderFilesList();
                renderBackupInfo();
                updateServerStats();

                // Users Tab Events
                document.getElementById('addUserBtn')?.addEventListener('click', addUser);
                document.getElementById('newEventUser')?.addEventListener('focus', populateUserSelects);
                document.getElementById('newClockUser')?.addEventListener('focus', populateUserSelects);

                // Events Tab Events
                document.getElementById('addEventManagerBtn')?.addEventListener('click', addEventManager);

                // Clock Tab Events
                document.getElementById('addClockBtn')?.addEventListener('click', addClockManager);

                // Recovery Tab Events
                document.getElementById('exportDataBtn')?.addEventListener('click', exportData);
                document.getElementById('importDataBtn')?.addEventListener('click', () => {
                    document.getElementById('importFile').click();
                });
                document.getElementById('importFile')?.addEventListener('change', importData);
                document.getElementById('resetPasswordsBtn')?.addEventListener('click', resetAllPasswords);
                document.getElementById('clearChangedPasswordsBtn')?.addEventListener('click', clearPasswordChanges);
            }
        }

        // ============================================
        // User Management
        // ============================================

        function renderUsersList() {
            const users = getUsers();
            const usersList = document.getElementById('usersList');
            if (!usersList) return;

            usersList.innerHTML = '';
            users.forEach((user, index) => {
                const userEl = document.createElement('div');
                userEl.className = 'user-item p-4 rounded flex justify-between items-center';
                userEl.innerHTML = `
                    <div class="flex-1">
                        <p class="font-bold text-white">${user.user}</p>
                        <p class="text-sm text-purple-300">${user.role}</p>
                    </div>
                    <div class="flex gap-2">
                        <button onclick="editUser(${index})" class="btn-secondary px-3 py-1 rounded text-sm text-white">
                            ‚úèÔ∏è Modifier
                        </button>
                        <button onclick="deleteUser(${index})" class="bg-red-700 hover:bg-red-600 px-3 py-1 rounded text-sm text-white transition">
                            üóëÔ∏è Supprimer
                        </button>
                    </div>
                `;
                usersList.appendChild(userEl);
            });
        }

        function addUser() {
            const name = document.getElementById('newUserName').value.trim();
            const pass = document.getElementById('newUserPass').value.trim();
            const role = document.getElementById('newUserRole').value;

            if (!name || !pass) {
                showToast('Veuillez remplir tous les champs', 'error');
                return;
            }

            const users = getUsers();
            if (users.find(u => u.user === name)) {
                showToast('Cet utilisateur existe d√©j√†', 'error');
                return;
            }

            users.push({ user: name, pass: pass, role: role });
            saveUsers(users);

            document.getElementById('newUserName').value = '';
            document.getElementById('newUserPass').value = '';
            document.getElementById('newUserRole').value = 'Employ√©';

            renderUsersList();
            updateServerStats();
            showToast(`Utilisateur ${name} cr√©√© avec succ√®s`);
        }

        function editUser(index) {
            const users = getUsers();
            const user = users[index];
            const newName = prompt('Nouvel identifiant (vide = inchang√©):', user.user);
            if (newName === null) return;

            if (newName && newName !== user.user) {
                if (users.find(u => u.user === newName)) {
                    showToast('Cet identifiant existe d√©j√†', 'error');
                    return;
                }
                user.user = newName;
            }

            const newPass = prompt('Nouveau mot de passe (vide = inchang√©):', '');
            if (newPass === null) return;
            if (newPass) user.pass = newPass;

            const newRole = prompt('Nouveau r√¥le (Employ√©/Patron/Gestionnaire Serveur):', user.role);
            if (newRole === null) return;
            if (newRole) user.role = newRole;

            saveUsers(users);
            renderUsersList();
            showToast('Utilisateur modifi√© avec succ√®s');
        }

        function deleteUser(index) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cet utilisateur ?')) return;
            const users = getUsers();
            const userName = users[index].user;
            users.splice(index, 1);
            saveUsers(users);
            renderUsersList();
            updateServerStats();
            showToast(`Utilisateur ${userName} supprim√©`);
        }

        // ============================================
        // Events Management
        // ============================================

        function renderEventsList() {
            const events = getEvents();
            const eventsList = document.getElementById('eventsList');
            if (!eventsList) return;

            eventsList.innerHTML = '';
            if (events.length === 0) {
                eventsList.innerHTML = '<p class="text-gray-500 text-center py-4">Aucun √©v√©nement enregistr√©</p>';
                return;
            }

            events.slice().reverse().forEach((event, idx) => {
                const eventEl = document.createElement('div');
                eventEl.className = 'bg-black/30 p-3 rounded flex justify-between items-center';
                eventEl.innerHTML = `
                    <div class="flex-1">
                        <p class="font-bold text-white">${event.text}</p>
                        <p class="text-xs text-gray-400">${event.user} ‚Ä¢ ${event.date}</p>
                    </div>
                    <button onclick="deleteEventManager('${event.id}')" class="bg-red-700 hover:bg-red-600 px-3 py-1 rounded text-xs text-white transition">
                        Supprimer
                    </button>
                `;
                eventsList.appendChild(eventEl);
            });
        }

        function populateUserSelects() {
            const users = getUsers().filter(u => u.role === 'Employ√©' || u.role === 'Patron');
            const selects = [document.getElementById('newEventUser'), document.getElementById('newClockUser')];

            selects.forEach(select => {
                if (!select) return;
                const currentValue = select.value;
                select.innerHTML = '<option value="">S√©lectionner...</option>';
                users.forEach(user => {
                    const option = document.createElement('option');
                    option.value = user.user;
                    option.textContent = user.user;
                    select.appendChild(option);
                });
                select.value = currentValue;
            });
        }

        function addEventManager() {
            const user = document.getElementById('newEventUser').value;
            const date = document.getElementById('newEventDate').value;
            const text = document.getElementById('newEventText').value.trim();

            if (!user || !date || !text) {
                showToast('Veuillez remplir tous les champs', 'error');
                return;
            }

            const events = getEvents();
            events.push({
                id: Date.now().toString(),
                date: date,
                text: text,
                user: user,
                createdAt: new Date().toISOString()
            });
            saveEvents(events);

            document.getElementById('newEventUser').value = '';
            document.getElementById('newEventDate').value = '';
            document.getElementById('newEventText').value = '';

            renderEventsList();
            updateServerStats();
            showToast('√âv√©nement ajout√© avec succ√®s');
        }

        function deleteEventManager(eventId) {
            const events = getEvents();
            const index = events.findIndex(e => e.id === eventId);
            if (index !== -1) {
                events.splice(index, 1);
                saveEvents(events);
                renderEventsList();
                updateServerStats();
                showToast('√âv√©nement supprim√©');
            }
        }

        // ============================================
        // Clock Management
        // ============================================

        function renderClockList() {
            const entries = getClockEntries();
            const clockList = document.getElementById('clockManagerList');
            if (!clockList) return;

            clockList.innerHTML = '';
            if (entries.length === 0) {
                clockList.innerHTML = '<p class="text-gray-500 text-center py-4">Aucun pointage enregistr√©</p>';
                return;
            }

            entries.slice(-50).reverse().forEach(entry => {
                const entryEl = document.createElement('div');
                const date = new Date(entry.timestamp);
                const displayTime = date.toLocaleString('fr-FR');
                const color = entry.type === 'Entr√©e' ? 'text-green-400' : 'text-red-400';

                entryEl.className = 'bg-black/30 p-3 rounded flex justify-between items-center';
                entryEl.innerHTML = `
                    <div class="flex-1">
                        <p class="font-bold text-white">${entry.user}</p>
                        <p class="text-xs text-gray-400">${displayTime}</p>
                    </div>
                    <div class="flex gap-2">
                        <span class="${color} font-bold">${entry.type === 'Entr√©e' ? '‚úì' : '‚úï'} ${entry.type}</span>
                        <button onclick="deleteClockManager('${entry.id}')" class="bg-red-700 hover:bg-red-600 px-2 py-1 rounded text-xs text-white transition">
                            Supprimer
                        </button>
                    </div>
                `;
                clockList.appendChild(entryEl);
            });
        }

        function addClockManager() {
            const user = document.getElementById('newClockUser').value;
            const type = document.getElementById('newClockType').value;
            const timeStr = document.getElementById('newClockTime').value;

            if (!user || !timeStr) {
                showToast('Veuillez remplir tous les champs', 'error');
                return;
            }

            const entries = getClockEntries();
            const timestamp = new Date(timeStr).toISOString();

            entries.push({
                id: Date.now().toString(),
                type: type,
                user: user,
                timestamp: timestamp,
                displayTime: new Date(timeStr).toLocaleString('fr-FR')
            });
            saveClockEntries(entries);

            document.getElementById('newClockUser').value = '';
            document.getElementById('newClockTime').value = '';

            renderClockList();
            updateServerStats();
            showToast('Pointage ajout√© avec succ√®s');
        }

        function deleteClockManager(entryId) {
            const entries = getClockEntries();
            const index = entries.findIndex(e => e.id === entryId);
            if (index !== -1) {
                entries.splice(index, 1);
                saveClockEntries(entries);
                renderClockList();
                updateServerStats();
                showToast('Pointage supprim√©');
            }
        }

        // ============================================
        // Files Management
        // ============================================

        function renderFilesList() {
            const files = getFiles();
            const filesList = document.getElementById('filesManagerList');
            if (!filesList) return;

            filesList.innerHTML = '';
            if (files.length === 0) {
                filesList.innerHTML = '<p class="text-gray-500 text-center py-4">Aucun fichier upload√©</p>';
                return;
            }

            files.slice().reverse().forEach(file => {
                const fileEl = document.createElement('div');
                fileEl.className = 'bg-black/30 p-3 rounded flex justify-between items-center';
                fileEl.innerHTML = `
                    <div class="flex-1">
                        <p class="font-bold text-white">üìÑ ${file.name}</p>
                        <p class="text-xs text-gray-400">${file.user} ‚Ä¢ ${file.size} ‚Ä¢ ${file.displayDate}</p>
                    </div>
                    <button onclick="deleteFileManager('${file.id}')" class="bg-red-700 hover:bg-red-600 px-3 py-1 rounded text-xs text-white transition">
                        Supprimer
                    </button>
                `;
                filesList.appendChild(fileEl);
            });
        }

        function deleteFileManager(fileId) {
            const files = getFiles();
            const index = files.findIndex(f => f.id === fileId);
            if (index !== -1) {
                files.splice(index, 1);
                saveFiles(files);
                renderFilesList();
                updateServerStats();
                showToast('Fichier supprim√©');
            }
        }

        // ============================================
        // Recovery & Data Management
        // ============================================

        function renderBackupInfo() {
            const backupInfo = document.getElementById('backupInfo');
            if (!backupInfo) return;

            const users = getUsers();
            backupInfo.innerHTML = `
                <div>Utilisateurs: <strong>${users.length}</strong></div>
                <div>√âv√©nements: <strong>${getEvents().length}</strong></div>
                <div>Pointages: <strong>${getClockEntries().length}</strong></div>
                <div>Fichiers: <strong>${getFiles().length}</strong></div>
                <div class="text-xs mt-2">Derni√®re mise √† jour: <strong>${new Date().toLocaleString('fr-FR')}</strong></div>
            `;
        }

        function updateServerStats() {
            document.getElementById('statsUsers').textContent = getUsers().length;
            document.getElementById('statsEvents').textContent = getEvents().length;
            document.getElementById('statsClock').textContent = getClockEntries().length;
            document.getElementById('statsFiles').textContent = getFiles().length;
        }

        function exportData() {
            const data = {
                users: getUsers(),
                events: getEvents(),
                clock: getClockEntries(),
                files: getFiles(),
                exportedAt: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `garage-backup-${Date.now()}.json`;
            link.click();
            URL.revokeObjectURL(url);

            showToast('‚úì Donn√©es export√©es avec succ√®s');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('√ätes-vous s√ªr ? Cette action remplacera toutes les donn√©es.')) {
                        if (data.users) saveUsers(data.users);
                        if (data.events) saveEvents(data.events);
                        if (data.clock) saveClockEntries(data.clock);
                        if (data.files) saveFiles(data.files);

                        renderUsersList();
                        renderEventsList();
                        renderClockList();
                        renderFilesList();
                        renderBackupInfo();
                        updateServerStats();

                        showToast('‚úì Donn√©es import√©es avec succ√®s');
                    }
                } catch (error) {
                    showToast('‚ùå Erreur lors de l\'importation', 'error');
                }
            };
            reader.readAsText(file);
            document.getElementById('importFile').value = '';
        }

        function resetAllPasswords() {
            if (!confirm('Tous les mots de passe seront d√©finis √† "password123". Continuer ?')) return;

            const users = getUsers();
            users.forEach(user => {
                user.pass = 'password123';
            });
            saveUsers(users);
            localStorage.removeItem('passwordChanged');

            showToast('‚úì Tous les mots de passe ont √©t√© r√©initialis√©s');
        }

        function clearPasswordChanges() {
            if (!confirm('Les utilisateurs devront changer leur mot de passe √† la prochaine connexion. Continuer ?')) return;

            localStorage.removeItem('passwordChanged');
            showToast('‚úì Les changements de mots de passe ont √©t√© r√©initialis√©s');
        }

        // ============================================
        // Initialization
        // ============================================

        document.addEventListener('DOMContentLoaded', () => {
            initializeStorage();
            renderPage();
        });
    </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9caee64ee21fd131',t:'MTc3MDU5MzI2Ny4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
